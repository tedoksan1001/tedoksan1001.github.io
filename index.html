<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SÄ±nÄ±f Ã‡ekiliÅŸi</title>
<style>
  body { font-family: sans-serif; text-align: center; padding: 50px; background: #f0f0f0; }
  button { padding: 10px 20px; font-size: 18px; cursor: pointer; margin-top: 20px; }
  #sonuc { margin-top: 30px; font-size: 24px; font-weight: bold; }
</style>
</head>
<body>
<h1>ðŸŽ‰ SÄ±nÄ±f Ã‡ekiliÅŸi ðŸŽ‰</h1>
<button id="cekilisBtn">Ã‡ekiliÅŸi Yap</button>
<p id="sonuc">Bekle...</p>

<script type="module">
// Firebase import
import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js";
import { getFirestore, collection, getDocs, doc, deleteDoc } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js";

// Firebase config (kendi projenin bilgileri ile deÄŸiÅŸtir)
const firebaseConfig = {
  apiKey: "AIzaSyDXZ8Tu6o-thj0QnhSwlPCEfXYlIMPP1rY",
  authDomain: "yilbasicekilis-cfd51.firebaseapp.com",
  projectId: "yilbasicekilis-cfd51",
  storageBucket: "yilbasicekilis-cfd51.firebasestorage.app",
  messagingSenderId: "747733053754",
  appId: "1:747733053754:web:c28d081f0dd90b1da5a003"
};

// Firebase baÅŸlat
const app = initializeApp(firebaseConfig);
const db = getFirestore(app);
const kisilerRef = collection(db, "kisiler");

const btn = document.getElementById("cekilisBtn");
const sonuc = document.getElementById("sonuc");

btn.addEventListener("click", async () => {
    sonuc.textContent = "Ã‡ekiliyor...";
    // Firestoreâ€™dan tÃ¼m isimleri Ã§ek
    const snapshot = await getDocs(kisilerRef);
    const kisiler = snapshot.docs.map(d => ({id: d.id, isim: d.data().isim}));

    if(kisiler.length === 0){
        sonuc.textContent = "TÃ¼m isimler Ã§ekildi!";
        return;
    }

    // Rastgele isim seÃ§
    const secilen = kisiler[Math.floor(Math.random() * kisiler.length)];
    sonuc.textContent = `ðŸŽ‰ ${secilen.isim} ðŸŽ‰`;

    // Firestoreâ€™dan sil
    await deleteDoc(doc(db, "kisiler", secilen.id));

    // Hash ve txt dosya indir
    const hash = btoa(secilen.isim);
    const blob = new Blob([hash], {type: "text/plain"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement("a");
    a.href = url;
    a.download = `${secilen.isim}_hash.txt`;
    a.click();
    URL.revokeObjectURL(url);
});
</script>
</body>
</html>